<div *ngIf="loading" class="h-screen">
  <div
    class="fixed inset-0 flex items-center justify-center rounded-lg bg-black bg-opacity-60 text-primary"
  >
    <span class="loading loading-infinity w-32"></span>
  </div>
</div>
<div>
  <button
    *ngIf="!isDrawerOpen() && !showMap"
    class="btn btn-primary fixed top-20 z-10 rounded-e-md rounded-s-none text-textp"
    (click)="drawer.toggle()"
  >
    <i class="fa-solid fa-angles-right"></i>
  </button>
  <mat-sidenav-container autosize="true" class="bg-base-100">
    <mat-sidenav
      style="background-color: var(--secondary-color)"
      mode="side"
      closed
      #drawer
      class="relative mt-20"
    >
      <button
        *ngIf="isDrawerOpen()"
        class="btn btn-secondary absolute bottom-0 z-10 w-auto rounded-e-md rounded-s-none text-textp"
        (click)="drawer.toggle()"
      >
        <i class="fa-solid fa-angles-left"></i>
        Hide sidebar
      </button>
      <mat-nav-list *ngIf="!loadingGuide" class="mb-12 space-y-2">
        <ul class="menu rounded-box">
          <li>
            <details open>
              <summary class="btn-success">
                <a
                  class="text-lg font-semibold"
                  (click)="$event.stopPropagation()"
                  (click)="scrollToSection(overview, 'overview')"
                  >Overview</a
                >
              </summary>
              <ul class="text-textp">
                <li
                  (click)="scrollToDynamicSection('generalTips')"
                  class="w-28"
                >
                  <p class="line-clamp-1">General Tips</p>
                </li>
                <li
                  class="w-32"
                  (click)="scrollToDynamicSection('' + sectionI)"
                  *ngFor="let section of guide.sections; let sectionI = index"
                >
                  <span *ngIf="section.name" class="line-clamp-1 w-28">
                    {{ section.name }}
                  </span>
                  <p *ngIf="!section.name" class="line-clamp-1">Untitled</p>
                </li>
              </ul>
            </details>
          </li>
        </ul>
      </mat-nav-list>
    </mat-sidenav>
    <mat-sidenav-content #sideNavContent class="bg-base-100">
      <div
        *ngIf="!loadingGuide"
        class="flex h-screen w-full md:w-2/3 lg:w-1/2"
        [ngClass]="{
          'cXl:w-[55%]': isDrawerOpen(),
          'cXl:w-[50%]': !isDrawerOpen(),
          'w-full': !showMap,
          hidden: showMap
        }"
      >
        <div class="mt-20 w-full" *ngIf="guide" #overview>
          <div class="h-2/5 w-full">
            <img
              src="{{ guide.coverPhoto }}"
              class="h-full w-full object-cover"
            />
          </div>

          <div class="flex flex-col items-center">
            <div class="card -mt-24 w-4/5 bg-secondary shadow-xl">
              <div class="card-body">
                <div class="flex">
                  <h1
                    class="card-title w-full max-w-md text-ellipsis text-xl text-textp sm:text-3xl"
                  >
                    {{ guide.name }}
                  </h1>
                </div>

                <div class="card-actions mt-4 justify-between sm:mt-8">
                  <span class="text-sm text-texts sm:text-base">
                    <i class="fa-regular fa-calendar mr-2"></i>
                    Created at:
                    {{ guide.createdAt! | date }}
                  </span>
                </div>
              </div>
            </div>

            <div
              class="my-10 flex w-full flex-col items-center justify-center text-textp"
            >
              <div class="w-full space-y-4 px-5 sm:px-10">
                <div class="flex w-full items-center justify-between px-10">
                  <div class="flex items-center space-x-2">
                    <div class="avatar">
                      <div class="w-8 rounded-full sm:w-14">
                        <img [src]="guide.writer?.profilePic" />
                      </div>
                    </div>
                    <span>{{ guide.writer?.username }}</span>
                  </div>
                  <div>
                    <button class="btn btn-sm sm:btn-md">
                      <i class="fa-regular fa-heart"></i>
                      {{ guide.likes?.length }}
                    </button>
                  </div>
                </div>
                <div></div>
                <section class="section-generalTips scroll-m-20">
                  <div class="collapse-arrow collapse bg-base-100 text-textp">
                    <input checked type="checkbox" />
                    <div class="collapse-title text-xl font-semibold">
                      General Tips
                    </div>
                    <div class="collapse-content"></div>
                  </div>
                </section>
                <section
                  *ngFor="let section of guide?.sections; let sectionI = index"
                  ngClass="section-{{ sectionI }}"
                  class="w-full scroll-m-20"
                ></section>
                <div class="divider"></div>
              </div>
            </div>
          </div>
        </div>
        <button
          (click)="$event.stopPropagation()"
          *ngIf="!showMap"
          type="button"
          class="btn btn-success btn-sm fixed bottom-6 left-1/2 -translate-x-1/2 transform normal-case md:hidden"
          (click)="showMapFn()"
        >
          <i class="fa-solid fa-map-location-dot"></i>
          Map view
        </button>
      </div>
      <div
        id="map"
        [ngClass]="{
          'cXl:w-[41%]': isDrawerOpen(),
          'cXl:w-[51%]': !isDrawerOpen(),
          'slide-in': showMap,
          'slide-out': !showMap
        }"
        class="no-animation fixed bottom-0 right-0 top-20 w-full md:w-1/3 lg:w-1/2"
      ></div>
      <button
        *ngIf="showMap"
        class="btn btn-success btn-sm fixed right-4 top-28 normal-case"
        (click)="closeMap()"
      >
        <i class="fa-solid fa-xmark"></i>
        Exit map
      </button>
    </mat-sidenav-content>
  </mat-sidenav-container>
</div>
